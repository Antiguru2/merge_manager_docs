# Архитектурные решения

## ADR-001: Регистрация профилей через настройки
- **Контекст:** требуется переиспользуемый модуль без жёсткой привязки к конкретным моделям.
- **Решение:** хранить конфигурацию профилей в `MERGE_MANAGER_SETTINGS['PROFILES']`, загружая их при старте приложения.
- **Последствия:**
  - Можно описывать профили в проектном коде или через фабрики.
  - Изменения конфигурации не требуют деплоя подмодуля.
  - Нужно следить за порядком импорта (решено ленивой загрузкой в `AppConfig.ready`).

## ADR-002: Использование ContentType в журнале операций
- **Контекст:** подмодуль должен работать с произвольными моделями и хранить аудит универсально.
- **Решение:** поля `target_content_type`/`donor_content_type` + `GenericForeignKey` в `MergeOperation`.
- **Последствия:**
  - Журнал может ссылаться на любую модель в проекте.
  - Упрощается админский просмотр и интеграция с аналитикой.
  - Нужна дополнительная оптимизация индексов (реализована в миграции).

## ADR-003: Soft-delete вместо hard-delete
- **Контекст:** важно не терять историю и сохранить возможность восстановления данных после слияния.
- **Решение:** по умолчанию менять `is_active` на `False`, поле можно переопределить в профиле.
- **Последствия:**
  - Минимизируется риск потери данных.
  - Требуется отдельная чистка архивных записей (в планах).
  - В интерфейсе нужно явно указывать, что донор отключён, но не удалён.

## ADR-004: Перенос связей средствами ORM
- **Контекст:** необходимо обеспечить перенос FK/M2M без прямых SQL скриптов.
- **Решение:** использовать возможности ORM (bulk `update`, `add/remove`) по всем авто-сгенерированным связям.
- **Последствия:**
  - Работает для большинства стандартных связей.
  - Экзотические поля (например, кастомные менеджеры) требуют ручной доработки профиля.
